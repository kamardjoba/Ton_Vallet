# Отладка ошибок восстановления кошелька

## Проблема
```
Uncaught SyntaxError: Unexpected token 'export'
Failed to restore wallet: Error: An unexpected error occurred
```

## Исправления

### 1. Изменен формат сборки
**Файл:** `vite.config.ts`

Изменен формат с `iife` на `es` для лучшей совместимости с современными браузерами и Telegram Mini App.

### 2. Улучшено логирование ошибок
**Файлы:** 
- `src/app/store.ts`
- `src/blockchain/ton.ts`

Добавлено детальное логирование ошибок в консоль для отладки:
- Полный объект ошибки
- Сообщение об ошибке
- Stack trace
- Дополнительная информация (количество слов, длина seed фразы и т.д.)

### 3. Улучшены сообщения об ошибках
Добавлены более специфичные сообщения для разных типов ошибок:
- Ошибки валидации seed фразы
- Ошибки Buffer polyfill
- Ошибки генерации кошелька

## Как отладить

### Шаг 1: Откройте консоль браузера
В Telegram Mini App:
1. Откройте приложение
2. Нажмите на три точки (меню)
3. Выберите "Open in Browser" или используйте DevTools

### Шаг 2: Попробуйте восстановить кошелек
1. Введите seed фразу
2. Введите пароль
3. Нажмите "Restore"

### Шаг 3: Проверьте консоль
Вы должны увидеть детальные логи:
```
initializeWallet error: [объект ошибки]
Error message: [сообщение]
Error stack: [stack trace]
generateWalletFromSeed error: [объект ошибки]
Error details: { message, stack, seedPhraseLength, wordsCount }
```

### Шаг 4: Анализ ошибки
Используйте информацию из консоли для определения проблемы:

**Если ошибка "Invalid seed phrase":**
- Проверьте, что все 24 слова правильные
- Убедитесь, что слова из BIP39 словаря
- Проверьте, что нет лишних пробелов

**Если ошибка "Buffer polyfill not loaded":**
- Убедитесь, что `polyfills.ts` загружается первым
- Проверьте, что Buffer доступен глобально

**Если ошибка "Failed to generate wallet":**
- Проверьте, что seed фраза совместима с TON
- Убедитесь, что используется правильный формат кошелька (v4R2)

## Возможные решения

### Проблема: "Unexpected token 'export'"
**Решение:**
1. Очистите кэш браузера
2. Пересоберите проект: `npm run build`
3. Убедитесь, что используете последнюю версию сборки

### Проблема: "Buffer is not defined"
**Решение:**
1. Убедитесь, что `polyfills.ts` импортируется первым в `main.tsx`
2. Проверьте, что `vite-plugin-node-polyfills` правильно настроен

### Проблема: "Failed to generate wallet"
**Решение:**
1. Проверьте логи в консоли для детальной информации
2. Убедитесь, что seed фраза корректна (24 слова)
3. Попробуйте использовать seed фразу из того же кошелька, где она была создана

## Технические детали

### Формат сборки
- **ES модули** - используется для современной совместимости
- **Telegram Mini App** поддерживает ES модули
- **CSP** настроен для разрешения модулей

### Polyfills
- Buffer polyfill загружается первым
- Все Node.js полифиллы включены через `vite-plugin-node-polyfills`

### Обработка ошибок
- Все ошибки логируются в консоль
- Пользователю показываются понятные сообщения
- Детальная информация доступна в консоли для разработчиков
